import urllib2
import csv
import requests
import os, sys
from bs4 import BeautifulSoup
from datetime import datetime

reload(sys)
sys.setdefaultencoding('UTF8')

try:
    urlarray = ["http://nari.nic.in/schemes?field_age_group_value%5B%5D=2&field_age_group_value%5B%5D=3&field_age_group_value%5B%5D=4&field_age_group_value%5B%5D=5&field_area_value%5B%5D=2&field_area_value%5B%5D=3&field_area_value%5B%5D=4&field_area_value%5B%5D=5&field_area_value%5B%5D=6&field_state_value%5B%5D=2&field_state_value%5B%5D=3&field_state_value%5B%5D=4&field_state_value%5B%5D=5&field_state_value%5B%5D=6&field_state_value%5B%5D=7&field_state_value%5B%5D=8&field_state_value%5B%5D=9&field_state_value%5B%5D=10&field_state_value%5B%5D=11&field_state_value%5B%5D=12&field_state_value%5B%5D=13&field_state_value%5B%5D=14&field_state_value%5B%5D=15&field_state_value%5B%5D=16&field_state_value%5B%5D=17&field_state_value%5B%5D=18&field_state_value%5B%5D=19&field_state_value%5B%5D=20&field_state_value%5B%5D=21&field_state_value%5B%5D=22&field_state_value%5B%5D=23&field_state_value%5B%5D=24&field_state_value%5B%5D=25&field_state_value%5B%5D=26&field_state_value%5B%5D=27&field_state_value%5B%5D=28&field_state_value%5B%5D=29&field_state_value%5B%5D=30&field_state_value%5B%5D=31&field_state_value%5B%5D=32&field_state_value%5B%5D=33&field_state_value%5B%5D=34&field_state_value%5B%5D=35&field_state_value%5B%5D=36&field_state_value%5B%5D=37&field_state_value%5B%5D=38",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=1",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=2",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=3",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=4",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=5",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=6",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=7",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=8",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=9",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=10",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=11",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=12",
    "http://nari.nic.in/schemes?field_age_group_value[0]=2&field_age_group_value[1]=3&field_age_group_value[2]=4&field_age_group_value[3]=5&field_area_value[0]=2&field_area_value[1]=3&field_area_value[2]=4&field_area_value[3]=5&field_area_value[4]=6&field_state_value[0]=2&field_state_value[1]=3&field_state_value[2]=4&field_state_value[3]=5&field_state_value[4]=6&field_state_value[5]=7&field_state_value[6]=8&field_state_value[7]=9&field_state_value[8]=10&field_state_value[9]=11&field_state_value[10]=12&field_state_value[11]=13&field_state_value[12]=14&field_state_value[13]=15&field_state_value[14]=16&field_state_value[15]=17&field_state_value[16]=18&field_state_value[17]=19&field_state_value[18]=20&field_state_value[19]=21&field_state_value[20]=22&field_state_value[21]=23&field_state_value[22]=24&field_state_value[23]=25&field_state_value[24]=26&field_state_value[25]=27&field_state_value[26]=28&field_state_value[27]=29&field_state_value[28]=30&field_state_value[29]=31&field_state_value[30]=32&field_state_value[31]=33&field_state_value[32]=34&field_state_value[33]=35&field_state_value[34]=36&field_state_value[35]=37&field_state_value[36]=38&page=12"
    ]

    total = 0
    for i in urlarray:
        quote_page = i
        page = urllib2.urlopen(quote_page)
        soup = BeautifulSoup(page, "html.parser")
        # print soup.find_all(match_class(["view-content", "ui-accordion", "ui-widget", "ui-helper-reset"]))
        headingValue = soup.find_all('h3', attrs={"class": "views-accordion-schemes-schemedisplay-header"})
        view_content = soup.find('div', attrs={"class":"view-content"})
        contentExcludingHeading = soup.find_all('div', attrs={"class":"views-row views-row-1 views-row-odd views-row-first views-row-last"})
        total = total + len(headingValue)
        #rowTest=soup.find_all('div' attrs={})
        arrayOfdivAfterContent =[]
        count=0
        k=0
        for sibling in headingValue:
            #print(sibling.find_next_sibling("div"))

            text=""
            link=""
            heading =""
            heading+=headingValue[k].text
            k+=1
            print('\n')
            count+=1
            #print(sibling)
            content=sibling.find_next_sibling("div").find_all('p')
            for pvalue in content:
                text+=pvalue.text
                text+='\n'
                aValue = pvalue.find_all('a',href=True, text=True)
                for a in aValue:
                    if a is not None:
                        text+=a['href']+'  '
                   
                #print(text)
            print(text)
            with open("Nari_3.csv", "a") as csv_file:
                # print("sha")
                # print('#####################################################')
                writer = csv.writer(csv_file)
                #    pdb;pdb.set_trace()
                writer.writerow([heading.encode('ascii', 'ignore'), text.encode('ascii', 'ignore'), datetime.now()])
            print('+++++');
            print('\n')
            #spans = sibling.find_all('div', attrs={"class":"col-xs-12 col-sm-4 col-md-4 pdleft"})
            #print(spans)
            print('\n')

        print(count)
        print(len(headingValue))
        print(total)
        print(len(arrayOfdivAfterContent))
        # print('\n')

except Exception as e:
    exc_type, exc_obj, exc_tb = sys.exc_info()
    fname = os.path.split(exc_tb.tb_frame.f_code.co_filename)[1]
    print(exc_type, fname, exc_tb.tb_lineno)
    # import pdb;pdb.set_trace()
    print(e)
    print("this is exception part")



